{% extends "page.njk" %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <span class="govuk-caption-l">Manage data share requests</span>
    <h1 class="govuk-heading-xl">Created requests</h1>
  </div>

  <div class="govuk-grid-column-one-third">
    <aside class="app-related-items">
        <nav role="navigation" aria-labelledby="subsection-title">
          <ul class="govuk-list">
            <li><a href="{{ assetpath }}/manage-shares/received-requests" class="govuk-link">View received requests</a></li>
             <li><a href="{{ assetpath }}/find" class="govuk-link">Find data to request</a></li>
          </ul>
        </nav>
    </aside>
  </div>
</div>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        {%- set monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"] -%}

        {%- set tableRows = [] -%}
        {%- for resourceID, formData in acquirerForms -%}
            {%- set formattedDate = "Unrequested" -%}
            {%- if formData.steps.date.value and formData.steps.date.value.day and formData.steps.date.value.month and formData.steps.date.value.year -%}
                {%- set monthIndex = formData.steps.date.value.month - 1 -%}
                {%- set monthName = monthNames[monthIndex] -%}
                {%- set formattedDate = formData.steps.date.value.day + " " + monthName + " " + formData.steps.date.value.year -%}
            {%- endif -%}
            {%- set row = [
                { html: '<a href="/acquirer/' + formData.requestId + '/summary">' + formData.requestId + '</a>' },
                { text: formData.assetTitle },
                { text: formData.ownedBy },
                { text: formattedDate },
                { html: govukTag({ text: formData.status, classes: "app-task-list__tag " + getStatusClass(formData.status) }) }
            ] -%}
        {%- set tableRows = (tableRows.push(row), tableRows) -%}
        {%- endfor -%}

        {{ govukTable({
            caption: "Pending requests",
            captionClasses: "govuk-table__caption--l",
            head: [
                {
                    text: "Request ID"
                },
                {
                    text: "Dataset"
                },
                {
                    text: "Owner"
                },
                {
                    text: "Needed by"
                },
                {
                    text: "Status"
                }
            ],
            rows: tableRows
        }) }}
    </div>
</div>

{% endblock %} 